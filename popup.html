<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TabTalk AI</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="container">
        <!-- HEADER: Always visible -->
        <header class="header">
            <div class="logo">
                <img src="icons/icon48.png" alt="logo" class="logo-icon">
                <h1>TabTalk AI</h1>
            </div>
            <div class="header-controls">
                <label class="dark-mode-label" title="Toggle Dark Mode">
                    <input type="checkbox" id="dark-mode-toggle">
                    <span class="dark-mode-icon">ğŸŒ“</span>
                </label>
                <button id="menu-button" class="menu-button" title="Menu">â˜°</button>
            </div>
        </header>

        <!-- QUICK ACTIONS: Summary & Key Points -->
        <div id="quick-actions" class="quick-actions hidden" aria-label="Quick actions">
            <button id="quick-summary" class="quick-btn" title="Generate summary">ğŸ“ Summary</button>
            <button id="quick-keypoints" class="quick-btn" title="Generate key points">ğŸ”‘ Key Points</button>
        </div>

        <!-- SIDEBAR: Hidden by default -->
        <div id="sidebar" class="sidebar hidden">
            <a href="#" id="menu-summary-link">ğŸ“ Summary</a>
            <a href="#" id="menu-keypoints-link">ğŸ”‘ Key Points</a>
            <a href="#" id="menu-analysis-link">ğŸ“Š Analysis Report</a>
            <a href="#" id="menu-faq-link">â“ FAQ Generator</a>
            <div class="sidebar-divider"></div>
            <a href="#" id="menu-settings-link">âš™ï¸ Gemini API Setup</a>
            <a href="#" id="menu-refresh-link">ğŸ—‘ï¸ Clear Chat</a>
        </div>

        <!-- MAIN CONTENT: This holds all our different views -->
        <main id="main-content">

            <!-- VIEW 1: SETTINGS (For entering the API Key) -->
            <div id="settings-view" class="view hidden">
                <h2>Gemini API Setup</h2>
                <div class="settings-container">
                    <div class="form-group api-key">
                        <label for="api-key-input">Gemini API Key</label>
                        <input type="password" id="api-key-input" placeholder="Paste your key here">
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" class="help-link">Get key</a>
                    </div>
                </div>
                <div class="button-group">
                    <button id="settings-cancel-button" class="button-secondary">Cancel</button>
                    <button id="settings-save-button" class="button-primary">Save</button>
                    <button id="delete-api-key-button" class="button-secondary hidden">Delete API Key</button>
                </div>
                <div class="onboarding-info">
                    <h3>Get started in 3 quick steps</h3>
                    <ol>
                        <li>Visit <strong>ai.google.com/studio</strong></li>
                        <li>Create an API key &amp; enable <strong>Gemini API</strong></li>
                        <li>Paste the key into TabTalk AI</li>
                    </ol>
                </div>
            </div>
            
            <!-- VIEW 3: CHAT (The main interface) -->
            <div id="chat-view" class="view hidden">
                <div class="page-info">
                    <p id="page-title">Loading page...</p>
                    <div id="page-status" class="page-status"></div>
                </div>
                <div id="messages-container" class="messages-container">
                    <!-- Chat messages will be added here by JavaScript -->
                </div>
                <div id="empty-state" class="empty-state hidden" aria-hidden="true">
                    <img src="icons/icon128.png" alt="TabTalk AI logo" class="hero">
                    <h2>Get started in 3 quick steps</h2>
                    <ol>
                        <li>Visit <strong>ai.google.com/studio</strong></li>
                        <li>Create an API key &amp; enable <strong>Gemini API</strong></li>
                        <li>Paste the key into TabTalk AI</li>
                    </ol>
                </div>
                <div class="input-area">
                    <div class="input-bar">
                        <textarea id="message-input" placeholder="Ask about this page..." rows="1" aria-label="Message input"></textarea>
                        <div class="formatting-toolbar">
                            <button class="format-button" title="Code" aria-label="Code block">{}</button>
                            <button class="format-button" title="Link" aria-label="Insert link">ğŸ”—</button>
                            <button class="tool-button" id="clear-chat-button" title="Clear chat" aria-label="Clear chat">ğŸ—‘ï¸</button>
                            <button class="tool-button" id="export-chat-button" title="Export chat" aria-label="Export chat">â¬‡ï¸</button>
                        </div>
                        <button id="send-button" title="Send message" aria-label="Send message" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855a.5.5 0 0 0-.09.89l4.736 3.14L13 5.5V9l2.25-3.25L13 2.5v3.75L4.159 9.25l4.776 3.175a.5.5 0 0 0 .75-.225l6.229-10.889a.5.5 0 0 0 .25-.625Z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="input-footer">
                        <span class="char-count" aria-live="polite">0/2000</span>
                    </div>
                </div>
            </div>

            <!-- VIEW 4: STATUS (For loading or critical errors) -->
            <div id="status-view" class="view hidden">
                <div class="spinner"></div>
                <p id="status-text">Initializing...</p>
            </div>
            
        </main>
    </div>
    <!-- Scripts -->
    <script src="marked.min.js"></script>
    <script src="html2pdf.bundle.min.js"></script>
    <script src="popup.js"></script>
    <div id="aria-status" class="visually-hidden" aria-live="polite"></div>
</body>
</html>