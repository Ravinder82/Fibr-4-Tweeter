<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TabTalk AI</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="container">
        <!-- HEADER: Always visible -->
        <header class="header">
            <div class="logo">
                <img src="icons/icon48.png" alt="logo" class="logo-icon">
                <h1>TabTalk AI</h1>
            </div>
            <button id="menu-button" class="menu-button" title="Menu">‚ò∞</button>
        </header>

        <!-- DROPDOWN MENU: Hidden by default -->
        <div id="dropdown-menu" class="dropdown-menu hidden">
            <a href="#" id="menu-settings-link">‚öôÔ∏è Settings</a>
            <a href="#" id="menu-refresh-link">üîÑ Re-Analyze Page</a>
        </div>

        <!-- MAIN CONTENT: This holds all our different views -->
        <main id="main-content">

            <!-- VIEW 1: ONBOARDING (For new users) -->
            <div id="onboarding-view" class="view hidden">
                <h2>Welcome to TabTalk AI!</h2>
                <p>To get started, you need a free Google Gemini API Key.</p>
                <button id="onboarding-go-to-settings" class="button-primary">Add API Key</button>
            </div>

            <!-- VIEW 2: SETTINGS (For entering the API Key) -->
            <div id="settings-view" class="view hidden">
                <h2>Settings</h2>
                <div class="form-group">
                    <label for="api-key-input">Gemini API Key</label>
                    <input type="password" id="api-key-input" placeholder="Paste your key here">
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="help-link">How to get a key?</a>
                </div>
                <div class="button-group">
                    <button id="settings-cancel-button" class="button-secondary">Cancel</button>
                    <button id="settings-save-button" class="button-primary">Save Key</button>
                </div>
            </div>
            
            <!-- VIEW 3: CHAT (The main interface) -->
            <div id="chat-view" class="view hidden">
                <div class="page-info">
                    <p id="page-title">Loading page...</p>
                    <div id="page-status" class="page-status"></div>
                </div>
                <div id="messages-container" class="messages-container">
                    <!-- Chat messages will be added here by JavaScript -->
                </div>
                <div class="input-area">
                    <textarea id="message-input" placeholder="Ask about this page..." rows="1"></textarea>
                    <button id="send-button" title="Send" disabled>‚ñ∂</button>
                </div>
            </div>

            <!-- VIEW 4: STATUS (For loading or critical errors) -->
            <div id="status-view" class="view">
                <div class="spinner"></div>
                <p id="status-text">Initializing...</p>
            </div>
            
        </main>
    </div>
    <!-- Scripts -->
    <script src="marked.min.js"></script>
    <script src="popup.js"></script>
</body>
</html>