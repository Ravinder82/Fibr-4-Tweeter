<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fibr</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="container">
        <!-- HEADER: Always visible -->
        <header class="header">
            <div class="logo">
                <img src="icons/icon48.png" alt="Fibr" class="logo-icon">
                <h1>Fibr</h1>
            </div>
            <div class="header-controls">
                <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme" title="Toggle theme">
                    <svg class="icon icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="4"></circle>
                        <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"></path>
                    </svg>
                    <svg class="icon icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
                <button id="menu-button" class="menu-button" title="Menu">‚ò∞</button>
            </div>
        </header>

        <!-- QUICK ACTIONS: Twitter Content Generation -->
        <div id="quick-actions" class="quick-actions-container hidden" aria-label="Quick actions">
            <div class="scroll-container">
                <div class="action-buttons-wrapper">
                    <!-- Twitter Post Generation -->
                    <button id="quick-twitter" class="action-btn" title="Generate Twitter/X post">
                        <span class="btn-text">Post</span>
                    </button>
                    <button id="quick-repost" class="action-btn" title="Generate reply/repost content">
                        <span class="btn-text">Repost</span>
                    </button>
                    <button id="quick-comments" class="action-btn" title="Generate comment replies">
                        <span class="btn-text">Comments</span>
                    </button>
                    <button id="quick-twitter-thread" class="action-btn" title="Generate Twitter/X thread">
                        <span class="btn-text">Thread</span>
                    </button>
                    <button id="quick-create" class="action-btn" title="Create thread on any topic">
                        <span class="btn-text">Create</span>
                    </button>
                                    </div>
            </div>
        </div>

            <!-- SIDEBAR: Hidden by default -->
        <div id="sidebar" class="sidebar hidden">
            <a href="#" id="menu-settings-link">Gemini API Setup</a>
            <a href="#" id="menu-gallery-link">Gallery</a>
            <a href="#" id="menu-privacy-link">Privacy &amp; Security</a>
        </div>

        <!-- MAIN CONTENT: This holds all our different views -->
        <main id="main-content">

            <!-- VIEW 1: WELCOME ONBOARDING (Minimal) -->
            <div id="welcome-view" class="view hidden">
                <div class="onboarding-container">
                    <div class="welcome-hero">
    <img src="icons/icon128.jpeg" alt="Fibr" class="welcome-logo">
    <h1 class="welcome-title">Welcome to Fibr</h1>
    <p class="welcome-subtitle">Transform any webpage into intelligent conversations</p>
                        <!-- Coming Soon Alert -->
                        <div class="coming-soon-alert">
                            <div class="alert-icon">üöÄ</div>
                            <h3 class="alert-title">New Features Coming Soon</h3>
                            <p class="alert-message">Enhanced AI capabilities and exciting tools are on the way!</p>
                        </div>
    </div>
                    <div class="onboarding-actions" style="margin-top: 12px;">
                        <button id="welcome-start" class="button-primary" aria-label="Start onboarding and go to API setup">Start</button>
                    </div>
                </div>
            </div>

            <!-- VIEW 2: API KEY SETUP -->
            <div id="api-setup-view" class="view hidden">
                <div class="setup-header-with-nav">
                    <button id="api-setup-back-arrow" class="header-back-btn" title="Back to Welcome" aria-label="Back to Welcome">‚Üê Back</button>
                </div>
                <div class="onboarding-container">
                    <div class="setup-header">
                        <h2>Setup Your AI Assistant</h2>
                        <p>Connect your Google Gemini API to unlock Fibr</p>
                    </div>
                    <div class="tutorial-steps">
                        <div class="step-item">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h3>Get Your API Key</h3>
                                <p>Visit Google AI Studio to create your free API key</p>
                                <a href="https://aistudio.google.com/app/apikey" target="_blank" class="tutorial-link">Open AI Studio ‚Üí</a>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h3>Copy Your Key</h3>
                                <p>Create a new API key and copy it to your clipboard</p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h3>Paste Below</h3>
                                <div class="api-input-group">
                                    <input type="password" id="onboarding-api-key" placeholder="Paste your API key here...">
                                    <button id="test-api-key" class="button-secondary">Test</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="onboarding-actions">
                        <button id="api-setup-back" class="button-secondary">Back</button>
                        <button id="api-setup-continue" class="button-primary" disabled>Continue</button>
                    </div>
                </div>
            </div>

            <!-- VIEW 3: SETTINGS (Legacy) -->
            <div id="settings-view" class="view hidden">
                <h2>Gemini API Setup</h2>
                <div class="settings-container">
                    <div class="form-group api-key">
                        <label for="api-key-input">Gemini API Key</label>
                        <input type="password" id="api-key-input" placeholder="Paste your key here">
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" class="help-link">Get key</a>
                    </div>
                </div>
                <div class="button-group">
                    <button id="settings-cancel-button" class="button-secondary">Cancel</button>
                    <button id="settings-save-button" class="button-primary">Save</button>
                    <button id="delete-api-key-button" class="button-secondary">Delete API Key</button>
                </div>
                <div class="onboarding-info">
                    <h3>Need help?</h3>
                    <p>Visit our tutorial for step-by-step guidance</p>
                </div>
            </div>
            
            <!-- VIEW 3: CONTENT GENERATION (Twitter/Thread cards display) -->
            <div id="chat-view" class="view hidden">
                <div class="page-info">
                    <p id="page-title">Loading page...</p>
                    <div id="page-status" class="page-status"></div>
                </div>
                <div id="messages-container" class="messages-container">
                    <!-- Generated content (Twitter cards, threads) will be added here by JavaScript -->
                </div>
            </div>

            <!-- VIEW 4: GALLERY (Saved Twitter Posts) -->
            <div id="gallery-view" class="view hidden">
                <div id="gallery-container" class="gallery-container"></div>
            </div>

            <!-- VIEW 5: STATUS (For loading or critical errors) -->
            <div id="status-view" class="view hidden">
                <div class="spinner"></div>
                <p id="status-text">Initializing...</p>
            </div>

            <!-- VIEW 6: THREAD LIBRARY REMOVED -->

            <!-- VIEW 9: PRIVACY & SECURITY POLICY -->
            <div id="privacy-view" class="view hidden">
                <div id="privacy-policy-container" class="privacy-view-container"></div>
            </div>
            
        </main>

        <!-- REPOST MODAL -->
        <div id="repost-modal" class="tone-modal hidden" role="dialog" aria-labelledby="repost-modal-title" aria-modal="true">
            <div class="tone-modal-overlay"></div>
            <div class="tone-modal-content">
                <div class="tone-modal-header">
                    <h2 id="repost-modal-title">Select Repost Tone</h2>
                    <button class="tone-modal-close repost-modal-close" aria-label="Close">&times;</button>
                </div>

                <!-- Reply/Repost Tone Grid -->
                <div class="modal-section">
                    <div class="tone-grid" role="radiogroup" aria-label="Select reply tone">
                        <!-- Reply tones will be populated here -->
                    </div>
                </div>

                <!-- Image Prompt Option -->
                <div class="image-prompt-section">
                    <label class="image-prompt-toggle">
                        <input type="checkbox" id="repost-include-image-prompt" class="image-prompt-checkbox">
                        <span class="image-prompt-label">
                            <svg class="image-prompt-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                            Generate Image Prompt (9:16 Nano Banana)
                        </span>
                    </label>
                    <p class="image-prompt-description">AI will create an optimized image prompt for your content</p>
                </div>

                <!-- Modal Actions -->
                <div class="tone-modal-actions">
                    <button id="repost-cancel-btn" class="tone-btn tone-btn-secondary">Cancel</button>
                    <button id="repost-generate-btn" class="tone-btn tone-btn-primary" disabled>
                        Generate
                    </button>
                </div>
            </div>
        </div>

        <!-- COMMENTS MODAL -->
        <div id="comments-modal" class="tone-modal hidden" role="dialog" aria-labelledby="comments-modal-title" aria-modal="true">
            <div class="tone-modal-overlay"></div>
            <div class="tone-modal-content">
                <div class="tone-modal-header">
                    <h2 id="comments-modal-title">Select Comment Tone</h2>
                    <button class="tone-modal-close comments-modal-close" aria-label="Close">&times;</button>
                </div>

                <!-- Comment Tone Grid -->
                <div class="modal-section">
                    <div class="tone-grid" role="radiogroup" aria-label="Select comment tone">
                        <!-- Comment tones will be populated here -->
                    </div>
                </div>

                <!-- Modal Actions -->
                <div class="tone-modal-actions">
                    <button id="comments-cancel-btn" class="tone-btn tone-btn-secondary">Cancel</button>
                    <button id="comments-generate-btn" class="tone-btn tone-btn-primary" disabled>
                        Generate
                    </button>
                </div>
            </div>
        </div>

        <!-- BOTTOM NAVIGATION BAR -->
        <nav id="bottom-nav" class="bottom-nav">
            <button class="nav-item active" data-view="chat" title="Home">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span class="nav-label">Home</span>
            </button>
            
            <button class="nav-item" data-view="gallery" title="Gallery">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
                <span class="nav-label">Gallery</span>
            </button>
        </nav>
    </div>
    <!-- Scripts -->
    <!-- All modules are now bundled into popup.js by esbuild -->
    <script src="modules/marked.min.js"></script>
    <script src="popup.js"></script>